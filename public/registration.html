<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>상품 등록</title>
    <link rel="stylesheet" href="styles.css" />
    <script>
      function goToMain() {
        window.location.href = "../index.html"; // 메인 페이지로 이동
      }
      function showMyPage() {
        window.location.href = "mypage.html"; // 마이 페이지로 이동
      }

      function goToRegister() {
        window.location.href = "registration.html";
      }
    </script>
  </head>
  <body>
    <!-- 상단 헤더 -->
    <div class="header">
      <div class="logo-container" onclick="goToMain()">
        <img
          src="./images/free-icon-auction-3211435.png"
          alt="Bid Icon"
          class="icon-small"
        />
        <span class="site-title">거래해요 경매의 숲</span>
      </div>

      <!-- 가운데 검색창 -->
      <div class="search-container">
        <input
          type="text"
          class="search-bar"
          placeholder="검색어를 입력하세요"
        />
        <span class="search-icon">🔍</span>
      </div>

      <!-- 마이페이지,로그인,상품등록 버튼 -->
      <div class="button-group">
        <button class="register" onclick="goToRegister()">상품 등록</button>
        <button class="login-button" onclick="goToLogin()">로그인</button>
        <button class="my-page" onclick="showMyPage()">마이페이지</button>
      </div>
    </div>

    <div class="form-container">
      <header>
        <h1>상품 등록</h1>
      </header>
      <form id="productForm" enctype="multipart/form-data">
        <label for="name">✔️ 상품명</label>
        <input
          type="text"
          id="name"
          name="name"
          placeholder="상품명을 입력하세요"
          required
        />

        <label for="productImage">✔️ 상품 이미지</label>
        <input
          type="file"
          id="productImage"
          name="productImage"
          accept="image/*"
        />

        <label for="startPrice">✔️ 경매 시작 가격</label>
        <input
          type="number"
          id="startPrice"
          name="startPrice"
          placeholder="경매 시작 가격을 입력하세요"
          required
        />

        <label for="description">✔️ 상품 설명</label>
        <textarea
          id="description"
          name="description"
          placeholder="상품에 대한 설명을 입력하세요(20자 내외)"
        ></textarea>

        <label for="category">✔️ 카테고리</label>
        <select id="category" name="category" required>
          <option value="의류">의류</option>
          <option value="가전제품">가전제품</option>
          <option value="생필품">생필품</option>
          <option value="뷰티/미용">뷰티/미용</option>
          <option value="식품">식품</option>
          <option value="가구">가구</option>
          <option value="도서">도서</option>
          <option value="반려동물용품">반려동물용품</option>
          <option value="기타">기타</option>
        </select>

        <label>✔️ 상태</label>
        <div class="radio-group">
          <label
            ><input type="radio" name="status" value="new" required /> 신규
            제품</label
          >
          <label
            ><input type="radio" name="status" value="used" required /> 중고
            제품</label
          >
        </div>

        <label for="endTime">✔️ 경매 종료 시간</label>
        <input type="datetime-local" id="endTime" name="endTime" required />

        <button type="submit" class="register-button">등록</button>
      </form>
    </div>

    <script>
      // 현재 날짜와 시간을 가져오기
      const now = new Date();

      // 내일 날짜 계산
      const tomorrow = new Date(
        now.getFullYear(),
        now.getMonth(),
        now.getDate() + 1
      );

      // 내일 날짜를 ISO 형식으로 변환 (yyyy-MM-ddTHH:mm)
      const isoTomorrow = new Date(
        tomorrow.getTime() - tomorrow.getTimezoneOffset() * 60000
      )
        .toISOString()
        .slice(0, 16);

      // <input> 필드 가져오기
      const endTimeInput = document.getElementById("endTime");

      // 입력 필드에 최소값으로 내일 날짜 설정
      endTimeInput.setAttribute("min", isoTomorrow);
    </script>

    <script>
      document
        .getElementById("productForm")
        .addEventListener("submit", async (event) => {
          event.preventDefault();

          const formData = new FormData(document.getElementById("productForm"));

          try {
            const response = await fetch(
              "http://localhost:3000/api/products/add",
              {
                method: "POST",
                body: formData,
              }
            );

            const result = await response.json();
            if (response.ok) {
              alert(result.message); // 성공 메시지 출력
            } else {
              alert(`오류: ${result.message}`); // 실패 메시지 출력
            }
          } catch (error) {
            console.error(error);
            alert("상품 등록 중 오류가 발생했습니다.");
          }
        });
    </script>
  </body>
</html>
