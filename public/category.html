<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>카테고리 상품 목록</title>
    <link rel="stylesheet" href="styles.css" />
    <script>
      // 상품 목록을 동적으로 표시
      async function displayProducts(categoryName) {
        const productList = document.getElementById("product-list");
        const categoryTitle = document.getElementById("category-title");

        // MongoDB에서 상품 데이터를 가져오기
        const response = await fetch(`/api/products?category=${categoryName}`);
        const products = await response.json();

        // 타이틀 설정
        categoryTitle.textContent = `${categoryName} 검색 결과`;

        // 기존 상품 목록 초기화
        productList.innerHTML = "";

        // 상품 데이터로 목록 생성
        products.forEach((product) => {
          const productItem = document.createElement("div");
          productItem.className = "product-item";

          productItem.innerHTML = `
          <img src="${product.image}" alt="${product.name}" />
          <h3>${product.name}</h3>
          <p class="price">${product.startPrice.toLocaleString()}원</p>
          <p>${product.description}</p>
        `;

          productList.appendChild(productItem);
        });
      }

      // URL에서 카테고리 가져오기
      function getCategoryFromURL() {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get("category");
      }

      // 페이지 로드 시 상품 표시
      document.addEventListener("DOMContentLoaded", () => {
        const categoryName = getCategoryFromURL();
        displayProducts(categoryName || "전체");
      });
    </script>
    <script>
      function goToMain() {
        window.location.href = "../index.html"; // 메인 페이지로 이동
      }
      function showMyPage() {
        window.location.href = "mypage.html"; // 마이 페이지로 이동
      }

      function goToRegister() {
        window.location.href = "registration.html";
      }
    </script>
  </head>
  <body>
    <!-- 상단 헤더 -->
    <div class="header">
      <div class="logo-container" onclick="goToMain()">
        <img
          src="./images/free-icon-auction-3211435.png"
          alt="Bid Icon"
          class="icon-small"
        />
        <span class="site-title">거래해요 경매의 숲</span>
      </div>

      <!-- 가운데 검색창 -->
      <div class="search-container">
        <input
          type="text"
          class="search-bar"
          placeholder="검색어를 입력하세요"
        />
        <span class="search-icon">🔍</span>
      </div>

      <!-- 마이페이지,로그인,상품등록 버튼 -->
      <div class="button-group">
        <button class="register" onclick="goToRegister()">상품 등록</button>
        <button class="login-button" onclick="goToLogin()">로그인</button>
        <button class="my-page" onclick="showMyPage()">마이페이지</button>
      </div>
    </div>

    <div class="container">
      <!-- 왼쪽 필터 영역 -->
      <div class="filter">
        <h3>가격 필터</h3>
        <form id="price-filter-form">
          <p>
            <label
              >0 - 1,000원<input
                type="checkbox"
                name="price-range"
                value="0-1000" /></label
            ><br />
            <label
              >1,000 - 5,000원<input
                type="checkbox"
                name="price-range"
                value="1000-5000" /></label
            ><br />
            <label
              >5,000 - 10,000원<input
                type="checkbox"
                name="price-range"
                value="5000-10000" /></label
            ><br />
            <label
              >10,000 - 100,000원<input
                type="checkbox"
                name="price-range"
                value="10000-100000" /></label
            ><br />
            <label
              >100,000 - 300,000원<input
                type="checkbox"
                name="price-range"
                value="100000-300000" /></label
            ><br />
            <button type="button" onclick="applyFilter()" class="link-button">
              적용하기
            </button>
          </p>
        </form>
        <div class="manual-price-filter">
          <label>직접 입력:</label><br />
          <input
            type="number"
            id="min-price"
            placeholder="최소가격(원)"
            style="width: 120px"
          />
          ~
          <input
            type="number"
            id="max-price"
            placeholder="최대가격(원)"
            style="width: 120px"
          /><br />
        </div>
      </div>

      <!-- 오른쪽 상품 리스트 -->
      <div class="product-container">
        <h1 id="category-title"></h1>
        <div class="product-list" id="product-list"></div>
      </div>
    </div>
  </body>
</html>
