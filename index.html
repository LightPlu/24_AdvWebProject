<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" href="./public/styles.css" />

    <title>경매 사이트</title>
  </head>
  <body>
    
    <!-- 로그인 팝업 -->
    <div id="loginPopup" class="popup">
      <div class="popup-content">
        <span class="close-btn" onclick="closePopup()">✖</span>
        <form id="loginForm">
          <!-- 이메일 입력 -->
          <div class="form-group">
            <input type="text" id="email" placeholder="아이디" required />
          </div>
          <!-- 비밀번호 입력 -->
          <div class="form-group password-group">
            <input
              type="password"
              id="password"
              placeholder="비밀번호"
              required
            />
            <span class="password-toggle" onclick="togglePassword()">👁️</span>
          </div>
          <!-- 로그인 버튼 -->
          <div class="form-group">
            <button type="submit" class="login-btn">로그인</button>
          </div>
          <!-- 하단 링크 -->
          <div class="links">
            <a href="/find-id">아이디(이메일) 찾기</a> |
            <a href="/find-password">비밀번호 찾기</a> |
            <a href="./public/signup.html">회원가입</a>
          </div>
        </form>
      </div>
    </div>
    <!-- 상단 헤더 -->
    <div class="header">
      <!-- 로고 이미지 -->

      <div class="logo-container" onclick="goToMain()">
        <img
          src="./public/images/free-icon-auction-3211435.png"
          alt="Bid Icon"
          class="icon-small"
        />
        <span class="site-title">거래해요 경매의 숲</span>
      </div>

      <!-- 가운데 검색창 -->
      <div class="search-container">
        <input
          type="text"
          class="search-bar"
          placeholder="검색어를 입력하세요"
        />
        <span class="search-icon">🔍</span>
      </div>

      <!-- 마이페이지,로그인,상품등록 버튼 -->
      <div class="button-group">
        <button id="register" class="register" onclick="goToRegister()">상품 등록</button>
        <button class="login-button" onclick="goToLogin()">로그인</button>
        <button class="my-page" onclick="showMyPage()">마이페이지</button>
      </div>
    </div>

    <!-- 메인 콘텐츠 -->
    <div class="main-container">
      <!-- 메인 이미지 -->
      <img
        src="./public/images/로고.png"
        alt="메인 이미지"
        class="main-image"
      />

      <!-- 경매 사용 방법 설명 -->
      <div class="overlay-content">
        <h2>거래해요 경매의 숲💸</h2>
        <p>
          경매의 숲에서는 다양한 상품을 손쉽게 경매로 만나볼 수 있습니다.
          관심있는 상품에 입찰하고, 빠르고 안전하게 결제와 배송을 진행하세요.
          자동 입찰 기능을 통해 더 편리하게 경매에 참여해 보세요!
        </p>
      </div>
    </div>

    <!-- 실시간 랭킹 -->
    <div class="ranking">
      <div class="ranking-header">
        <h3 class="ranking-title">실시간 랭킹</h3>
        <div class="ranking-items">
          <div class="ranking-item">1. 경매 물품 A</div>
          <div class="ranking-item">2. 경매 물품 B</div>
          <div class="ranking-item">3. 경매 물품 C</div>
          <div class="ranking-item">4. 경매 물품 D</div>
          <div class="ranking-item">5. 경매 물품 E</div>
        </div>
      </div>
    </div>

    <!-- 카테고리 버튼들 -->
    <div class="categories">
      <button class="category-button" onclick="openCategory('의류')">
        <img src="./public/images/의류.jpeg" alt="의류" class="button-image" />
        <span class="button-text">의류</span>
      </button>
      <button class="category-button" onclick="openCategory('가구')">
        <img src="./public/images/가구.jpeg" alt="가구" class="button-image" />
        <span class="button-text">가구</span>
      </button>
      <button class="category-button" onclick="openCategory('식품')">
        <img src="./public/images/식품.jpeg" alt="식품" class="button-image" />
        <span class="button-text">식품</span>
      </button>
      <button class="category-button" onclick="openCategory('가전제품')">
        <img
          src="./public/images/가전제품.jpeg"
          alt="가전제품"
          class="button-image"
        />
        <span class="button-text">가전제품</span>
      </button>
      <button class="category-button" onclick="openCategory('생필품')">
        <img
          src="./public/images/생필품.jpeg"
          alt="생필품"
          class="button-image"
        />
        <span class="button-text">생필품</span>
      </button>
      <button class="category-button" onclick="openCategory('뷰티/미용')">
        <img
          src="./public/images/뷰티미용.jpeg"
          alt="식뷰티/미용"
          class="button-image"
        />
        <span class="button-text">뷰티/미용</span>
      </button>
      <button class="category-button" onclick="openCategory('도서')">
        <img src="./public/images/도서.jpeg" alt="도서" class="button-image" />
        <span class="button-text">도서</span>
      </button>
      <button class="category-button" onclick="openCategory('반려동물용품')">
        <img
          src="./public/images/반려동물용품.jpeg"
          alt="반려동물용품"
          class="button-image"
        />
        <span class="button-text">반려동물용품</span>
      </button>
      <button class="category-button" onclick="openCategory('기타')">
        <img src="./public/images/기타.jpeg" alt="기타" class="button-image" />
        <span class="button-text">기타</span>
      </button>
    </div>

    <script>
      // 메인 화면으로 돌아가는 함수
      function goToMain() {
        window.location.href = "index.html"; // 메인 페이지로 이동
      }

      // 마이페이지 버튼 클릭 시 리스트 표시
      function showMyPage() {
        // /api/products/add 경로로 GET 요청
        fetch("/api/mypage", {
          method: "GET",
        })
          .then((response) => {
            if (response.ok) {
              // 요청 성공 시 registration.html로 이동
              window.location.href = "./public/mypage.html";
            } else {
              // 요청 실패 시 에러 메시지 처리
              alert("마이 페이지로 이동할 수 없습니다. 로그인이 필요합니다.");
            }
          })
          .catch((error) => {
            console.error("요청 중 오류 발생:", error);
            alert("요청 중 오류가 발생했습니다.");
          });
      }

      // 카테고리 버튼 클릭 시 창 열기
      function openCategory(categoryName) {
        window.location.href = `./public/category.html?category=${encodeURIComponent(
          categoryName
        )}`;
      }

      function togglePassword() {
        const passwordField = document.getElementById("password");
        const type =
          passwordField.getAttribute("type") === "password"
            ? "text"
            : "password";
        passwordField.setAttribute("type", type);
      }

      // 팝업 열기
      function goToLogin() {
        document.getElementById("loginPopup").style.display = "flex";
      }

      // 팝업 닫기
      function closePopup() {
        document.getElementById("loginPopup").style.display = "none";
      }

      function goToRegister() {
        // /api/products/add 경로로 GET 요청
        fetch("/api/products/add", {
          method: "GET",
        })
          .then((response) => {
            if (response.ok) {
              // 요청 성공 시 registration.html로 이동
              window.location.href = "./public/registration.html";
            } else {
              // 요청 실패 시 에러 메시지 처리
              alert("상품 등록 페이지로 이동할 수 없습니다. 로그인이 필요합니다.");
            }
          })
          .catch((error) => {
            console.error("요청 중 오류 발생:", error);
            alert("요청 중 오류가 발생했습니다.");
          });
      }

      function logout() {
        fetch("/api/logout", { method: "POST" })
          .then((response) => {
            if (response.ok) {
              alert("로그아웃 성공");
              updateAuthButton();
            } else {
              throw new Error("로그아웃 실패");
            }
          })
          .catch((error) => console.error("로그아웃 중 오류 발생:", error));
      }

      // 로그인 폼 제출 처리
      document
        .getElementById("loginForm")
        .addEventListener("submit", function (event) {
          event.preventDefault(); // 기본 제출 방지

          const email = document.getElementById("email").value;
          const password = document.getElementById("password").value;

          // 로그인 요청 처리 (예: 서버로 데이터 전송)
          fetch("/api/login", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email, password }),
          })
            .then((response) => {
              if (response.ok) {
                alert("로그인 성공!");
                closePopup(); // 팝업 닫기
                updateAuthButton();
              } else {
                alert("로그인 실패. 아이디와 비밀번호를 확인하세요.");
              }
            })
            .catch((error) => console.error("로그인 중 오류 발생:", error));
        });

    </script>
  </body>
</html>
